function DataGenerator(a){var b="var JoResLevel = function () {";b+="this.w = "+a.data.length+"; ",b+="this.h = "+a.data[0].length+"; ",b+="this.tileSize = "+a.tileSize+"; ",b+="this.terrain_sprite ="+a.terrain_sprite+"; ",b+="this.resources = [";for(var c=0;c<a.resources.length;c++)b+=a.resources[c],c!==a.resources.length-1&&(b+=",");b+="]; ",b+="this.sprite_index = [";for(var c=0;c<a.sprite_index.length;c++){var d=a.sprite_index[c];b+="{sprite:{x:"+d.sprite.x+",y:"+d.sprite.y,b+=",w:"+d.sprite.w+",h:"+d.sprite.h+"},",b+="AABB:{x:"+d.AABB.x+",y:"+d.AABB.y,b+=",w:"+d.AABB.w+",h:"+d.AABB.h+"}",b+="}",c!==a.sprite_index.length-1&&(b+=",")}b+="]; ",b+="this.data = [\n";for(var c=0;c<a.data.length;c++){b+="\t[";for(var e=0;e<a.data[c].length;e++){b+="\t\t[";for(var f=0;f<a.data[c][e].length;f++)b+=a.data[c][e][f],f!==a.data[c][e].length-1&&(b+=",");b+="]",e!==a.data[c].length-1&&(b+=","),b+="\n"}b+="]",c!==a.data.length-1&&(b+=","),b+="\n"}return b+="]; ",b+"}"}function Dialog(a){this.dialogElement=document.getElementById(a),this.dragbarElement=this.dialogElement.children[0],this.closeButtonElement=this.dragbarElement.children[0],this.content=function(){},this.buttons=[],this.selection=0,this.init=function(a,b){this.content(a,b)},this.dialogElement.joResDragClick={x:0,y:0,dragging:!1},this.setMouseEvents=function(){var a=this.dialogElement;this.dragbarElement.onmousedown=function(b){a.joResDragClick.x=b.offsetX,a.joResDragClick.y=b.offsetY,a.joResDragClick.dragging=!0,a.style.zindex=3,window.onmousemove=function(b){a.joResDragClick.dragging&&(a.style.left=b.clientX-a.joResDragClick.x+"px",a.style.top=b.clientY-a.joResDragClick.y+"px")}},this.dragbarElement.onmouseup=function(b){a.joResDragClick.dragging=!1,a.style.zindex=1},this.closeButtonElement.onclick=function(b){a.style.display="none"}},this.setMouseEvents(),this.minimize=function(){},this.maximize=function(){},this.show=function(){this.dialogElement.style.display="block"},this.hide=function(){this.dialogElement.style.display="none"}}function JoResGameCreator(){this.rsc=new ResourceLoader,this.screens={loading:JoResLoad,splash:JoResSplash,levelSelect:null,settings:null};var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAAlCAYAAAD7u09NAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AwOAQAtu6IdUgAAAiVJREFUaN7tWDGugzAMdb4ycQnmLFyhh6mYCluP0S1lqjjMv0IXZi6RNX8hyIQ4CXzgF/1YqoiCndgv2H4pQJIkSRYIc01+57mOtb30/eJNX89H9PpldT8UEE45U2fZzGmp1Dius0xLpVghBLy7brUDsmlnc/XtCgCgB/AOBebLNXnpe3h3HbN/ezlR364MAJz7yKbVAACFEH8HyH+WBEgCJAGSAEmAHMBDFkuAzJEkznCO4enkJ3gcIHUzzrJUn60Nus4ykEqx4TmZdxE5DAp2Egdrg2I7HGk32lD6ls1kj11SRirFbLAN83URLEPMyupuH5Bhq15CF0vkMAEsqzuTTQuyabVs2lH/42qIDcqeTBWx8PH6wT11YPXl7ROFqFWzGkIW1a0ub0cGaOqEeZbVnRVCaMLWpCR7PR8jKPysJ+66JeNTN4dIXEpxsdX17ToePD9xCpAdyNFlov9C4Na1n5k6MrRMLZUCyHM7nSZP0o7Q/03BRUHOOtDw1WgAYIUQWN/ZrewUI3mIK+9Cn2aE3UTf0g2t5bPd1K8kSZIkKYTQkXXQXVBcxrh/2+9d795dx/A4xtZXyI1ezN6+tZfae4PwbYABoO4J9jrUuj69mPEaG8qeU8EsacNmgxBIp/yDCAfkQ3JpTodSZone1vUG78l9n/qW12zsABVsrN6evnEDAFV8qPexm9m2riBj9UI2e/j2L1vtrO2eFYBQM0iSJMnu8gON3OByW0Ib0QAAAABJRU5ErkJggg==",b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAPCAYAAAB9YDbgAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAL5JREFUSA3Vko0KgCAMhC16/1cuJp4ca/4sGGlg03me34YpbfQdhfXegBmsaXXYzHcZHW2BS2W9PVixpnZj4iyfg5dE9sh5CCVi5I3y0zm9hlby/PHaOuPJpZOdO3Op7lWh0jMYb7XyrJmaz8JOmUWLrDeLO3VHRp3FuVH87KthLSCYS7T2NRz0Oo81PEY66GuMeAYCg1EvMiZuaA0r1borNkBCUtYzaAGjEyEgHtNlu1mKyHzc2dWBPc3/X/sAP64pCEy0Ns8AAAAASUVORK5CYII=";this.rsc.load([{name:"JoRes_logo",path:a},{name:"JoRes_start",path:b}]),this.core=null;var c=null,d=null,e=this;this.start=function(){function a(){e.update(),frame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,frame(a,e.core.graphics.getCanvas())}this.core=new CoreManager(16,e.rsc,"JoResGameCreator-target"),this.core.update();var b=!1,c=!1;this.rsc.whenReady(function(){b?e.build(0):c=!0}),this.screen("splash",function(){c?e.build(0):b=!0}),a()},this.update=function(){"function"==typeof this.core.applicationStateChange?(this.core.applicationStateChange(this),this.core.applicationStateChange=null):this.core.update()},this.build=function(a){this.core.close(),this.screen("loading"),this.rsc.load(this.getLevelPath(a)),this.rsc.whenReady(function(){e.core.component=new LevelCreator(e.unit_list),e.rsc.load(e.core.component.resources),e.rsc.whenReady(function(){e.core.init()})})},this.screen=function(a,b){this.core.close();var c=new this.screens[a](b);c.init(this.core.public()),this.core.graphics.addTask(c),this.core.camera.setFocusObj({x:0,y:0}),this.core.component=c},this.unit_list=[],this.addUnit=function(a){this.unit_list.push(a)},this.quit=function(){this.core.close()},this.setLevelPath=function(a){c=a},this.load=function(a){this.rsc.load(a)},this.setImgPath=function(a){d=a},this.getLevelPath=function(a){return c.replace("*",a)}}function LevelCreator(){var a=new Universe;return a.nav=new LevelCreatorNav,a.init=function(a,b){this.nav.init(a,b),b.addTask(new LevelGraphics(a)),b.disableDebug(),a.getCamera().setFocusObj(this.wizard),a.getCamera().setScaleBounds(1,2),a.getCamera().setTileSize(this.tileSize);for(var c=0;c<this.unit_data.length;c++)this.unit_data[c]>0&&this.addUnit(this.unit_data[c]-1,c*this.tileSize,c)},a.wizard={x:0,y:0,pos:{x:0,y:0},speed:2,update:function(b){var c=b.getController();c.a&&(this.x-=this.speed),c.d&&(this.x+=this.speed),c.w&&(this.y-=this.speed),c.s&&(this.y+=this.speed);var d=c.current;if(null!==d){var e=b.getCamera();this.pos.x=Math.trunc((d.offsetX/2+e.x)/b.getUniverse().tileSize),this.pos.y=Math.trunc((d.offsetY/2+e.y)/b.getUniverse().tileSize)}if(c.space){var f=window.open();f.document.open(),f.document.write("<html>"+DataGenerator(b.getUniverse())+"</html>"),f.document.close(),c.space=!1}c.isDown&&b.getUniverse().setBlock(this.pos.x,this.pos.y,a.nav.blockBrush())}},a.update=function(a){this.wizard.update(a)},a}function LevelCreatorNav(){var a=[];this.blockBrush=function(){return a[0].selection},this.init=function(b,c){a[0]=new Dialog("block_palette"),a[0].content=BlockPalette,a[1]=new Dialog("unit_palette"),a[1].content=UnitPalette,a[2]=new Dialog("selection_tools"),a[2].content=function(){},document.body.clientHeight>=600&&document.body.clientWidth>=800&&(a[3]=new Dialog("size_alert")),this.initAllDialogs(b,c)},this.initAllDialogs=function(b,c){for(var d=0;d<a.length;d++)a[d].init(b,c),a[d].show()}}function BlockPalette(a){for(var b=a.getUniverse(),c=b.sprite_index,d=b.tileSize,e=0;e<c.length;e++){var f=c[e].sprite,g=document.createElement("canvas");g.width=24,g.height=24,g.getContext("2d").drawImage(a.get(b.terrain_sprite),f.x*d,f.y*d,f.w,f.h,0,0,g.width,g.height);var h=this;this.buttons[e]=document.createElement("div"),this.buttons[e].appendChild(g),this.buttons[e].joResBlockIndex=e,this.buttons[e].onclick=function(a){h.selection=this.joResBlockIndex},document.getElementById("block_palette").children[1].appendChild(this.buttons[e])}}function UnitPalette(a){for(var b=a.getUniverse().unit_index,c=0;c<b.length;c++){var d;"function"==typeof b[c]?d=b[c]():"object"==typeof b[c]&&(d=Object.assign(b[c])),"function"!=typeof d.move&&(d.move=BasicAI[d.move]),d=Object.assign(new Unit(c,0,0),d);var e=d.sprite(a.getTime()),f=document.createElement("canvas");f.width=24,f.height=24,f.getContext("2d").drawImage(a.get(d.imgPath),e.x,e.y,e.w,e.h,0,0,f.width,f.height);var g=this;this.buttons[c]=document.createElement("div"),this.buttons[c].appendChild(f),this.buttons[c].joResUnitIndex=c,this.buttons[c].onclick=function(a){g.selection=this.joResUnitIndex},document.getElementById("unit_palette").children[1].appendChild(this.buttons[c])}}