function Camera(){this.x=0,this.y=0,this.focusObj=null,this.scale=1,this.maxScale=6,this.edgeBuffer=2,this.range={x:0,y:0};var a={areSet:!1,left:null,right:null,top:null,bottom:null};this.zoom=function(a){this.scale*=a,this.scale>this.maxScale&&(this.scale=this.maxScale)};var b=16;this.update=function(b,c){this.zoomed||this.resize(b,c);var d=b/(2*this.scale),e=c/(2*this.scale);this.x=Math.round(Math.round(this.focusObj.x)-d),this.y=Math.round(Math.round(this.focusObj.y)-e),a.areSet&&(this.x<a.left&&(this.x=a.left),this.x+b>a.right&&(this.x=a.right),this.y<a.top&&(this.y=a.top),this.y+c>a.bottom&&(this.y=a.bottom))},this.resize=function(a,c){this.range.x=Math.round(a/(b*this.scale)),this.range.y=Math.round(c/(b*this.scale)),this.zoomed=!0},this.setBounds=function(b,c,d,e,f){if("null"!=typeof b&&"number"!=typeof b&&"null"!=typeof c&&"number"!=typeof c&&"null"!=typeof d&&"number"!=typeof d&&"null"!=typeof e&&"number"!=typeof e)throw TypeError("4 arguements of {Null|Number} required");a.left=b,a.right=c,a.top=d,a.bottom=e,f!==!0&&(a.areSet=!0)},this.enableBounds=function(){a.areSet=!0},this.disableBounds=function(){a.areSet=!1},this.setFocusObj=function(a){this.focusObj=a}}function Control(){this.space=!1,this.setKey=function(a,b){if(a>=65&&a<=90){var c=String.fromCharCode(a);this[c.toLowerCase()]=b}else 32===a&&(this.space=b)};for(var a=65;a<=90;a++)this.setKey(a,!1);var b=this;window.onkeydown=function(a){b.setKey(a.which,!0)},window.onkeyup=function(a){b.setKey(a.which,!1)}}function ResourceLoader(){function a(a){return d[a]?d[a]:void(a.includes(".png")?b(a):a.includes(".js")&&c(a))}function b(a){var b=new Image;b.onload=function(){d[a]=b,f--,0===f&&e()},b.onerror=function(){console.log("file "+g+a+" doesn't exist"),d[a]=null,f--,0===f&&e()},d[a]=!1,b.src=g+a}function c(a){var b=document.createElement("script");b.type="text/javascript",b.src=h+a,document.body.appendChild(b),b.onload=function(){d[a]=b,f--,0===f&&e()},b.onerror=function(){console.log("file "+h+a+" doesn't exist"),d[a]=null,f--,0===f&&e()},d[a]=!1,b.src=h+a}var d={},e=function(){},f=0,g="rsc/img/",h="";this.load=function(b){b instanceof Array?(f+=b.length,b.forEach(function(b){a(b)})):(f++,a(b))},this.get=function(a){return d[a]},this.whenReady=function(a){e=a}}function UnitHandler(){this.list=[],this.p=null,this.newPlayer=function(a,b){var c=Object.assign(new Unit(this.list.length,a,b),new Player);this.list.push(c),this.p=c},this.newSoldier=function(a,b){var c=Object.assign(new Unit(this.list.length,a,b),new Soldier);this.list.push(c)},this.newRPGsoldier=function(a,b){var c=Object.assign(new Unit(this.list.length,a,b),new RPGsoldier);this.list.push(c)},this.update=function(a){if(this.list[0].x>0){for(var b=[],c=0;c<this.list.length;c++){var d=this.list[c];d.update(a),d.destroy&&b.push(d.id)}for(var c=0;c<b.length;c++)for(var e=0;c<this.list.length;e++)if(this.list[e].id===b[c]){this.list.splice(e,1);break}}}}function Universe(a,b,c){this.tileSize=a,this.rsc=c,this.time=new Clock,this.camera=new Camera,this.graphics=new Graphics(this.camera),this.units=new UnitHandler,this.level=new Level,this.stats=new Stats,this.controller=new Control,this.update=function(){},this.init=function(){},this.getUnits=function(){return this.units.list},this.getCanvas=function(){return this.graphics.canvas}}function LevelCreator(a,b,c){var d=new Universe(a,b,c);for(var e in d)d.hasOwnProperty(e)&&(this[e]=d[e]);this.units.newPlayer(150,70),this.wizard=new Wizard(0,0),this.wizard.setController(this.controller),this.camera.setFocusObj(this.wizard),this.camera.scale=2;var f=this.graphics;window.onresize=function(){f.zoomed=!1},this.update=function(){this.stats.addStat("fps",this.time.fps),this.time.update(),this.camera.update(window.innerWidth,window.innerHeight),this.graphics.print(this,this.units.p),this.wizard.update()}}function Wizard(a,b){this.x=a,this.y=b,this.vx=0,this.vy=0;var c=null;this.setController=function(a){c=a},this.update=function(){c.a&&this.x--,c.d&&this.x++,c.w&&this.y--,c.s&&this.y++}}function Unit(a,b,c){this.id=a,this.x=b,this.y=c,this.width=0,this.height=0,this.tick=200*Math.random(),this.direction=0,this.speed=1,this.maxSpeed=10,this.airbourne=!1,this.vx=0,this.vy=0,this.img="",this.imgDisplacement=[0,0],this.canMove=!0,this.health=1,this.maxHealth=1,this.destroy=!1,this.contact={left:!1,right:!1,up:!1,down:!1},this.aabb=function(){return{x:Math.round(this.x),y:Math.round(this.y),w:Math.round(this.width),h:Math.round(this.height),s:function(a,b){return a>this.x&&a<this.x+this.w&&(b>this.y&&b<this.y+this.h)},c:function(a){return this.x<a.x+a.w&&this.x+this.w>a.x&&this.y<a.y+a.h&&this.h+this.y>a.y}}},this.damage=function(a){this.health-=a,this.health<=0&&(this.destroy=!0)},this.points=function(a,b){var c=0,d=0;switch("undefined"!=typeof b&&(c=b.x,d=b.y),a){case 0:return{x:c,y:d};case 1:return{x:c,y:d+1*this.height/2};case 2:return{x:c,y:d+this.height};case 3:return{x:c+1*this.width/2,y:d};case 4:return{x:c+1*this.width/2,y:d+this.height};case 5:return{x:c+this.width,y:d};case 6:return{x:c+this.width,y:d+1*this.height/2};case 7:return{x:c+this.width,y:d+this.height};default:return 8}},this.update=function(a){this.move(a),this.vy+=.5;for(var b={x:this.x,y:this.y+this.vy},c=0;c<this.points();c++){var d=this.points(c,b),e=a.level.getBlockObject(d.x,d.y).AABB;if(e.s(d.x,d.y)){if(this.y+this.height<=e.y){b.y=e.y-this.height,this.vy=0,this.airbourne=!1,this.contact.down=!0;break}if(this.contact.down=!1,this.y>=e.y+e.h){b.y=e.y+e.h,this.vy=0,this.contact.up=!0;break}this.contact.up=!1}}this.y=b.y;for(var b={x:this.x+this.vx,y:this.y},c=0;c<this.points();c++){var d=this.points(c,b),e=a.level.getBlockObject(d.x,d.y).AABB;if(d=this.points(c,b),e.s(d.x,d.y)){if(this.x+this.width<=e.x){b.x=e.x-this.width,this.vx=0,this.contact.right=!0;break}if(this.contact.right=!1,this.x>=e.x+e.w){b.x=e.x+e.w,this.vx=0,this.contact.left=!0;break}this.contact.left=!1}}this.x=b.x},this.obj=function(a){var b=(a.it_10%2,{x:0,y:0,w:this.imgSize,h:this.imgSize,id:this.img}),c=this.aabb();c.x-=this.imgDisplacement[0],c.y-=this.imgDisplacement[1];var d=this.aabb();return 0===this.vx?1===this.direction?(b.x=0,b.y=0):0===this.direction&&(b.x=this.imgSize,b.y=0):this.vx>0?(b.x=a.it_12%3*this.imgSize,b.y=1*this.imgSize):this.vx<0&&(b.x=a.it_12%3*this.imgSize,b.y=2*this.imgSize),{sprite:b,pos:c,AABB:d}}}var Clock=function(){this.started=-1,this.now=0,this.last=0,this.dt=0,this.secLoop=0,this.sec=!1,this.nextsec=0,this.frames=0,this.fps=0,this.it_10=0,this.it_12=0,this.it_16=0,this.it_24=0;var a=.032;this.getSPF=function(){return this.dt<a?this.dt:a},this.update=function(){this.last=this.now,this.now=Date.now(),this.started<0&&(this.started=this.now),this.secLoop=0,this.dt=(this.now-this.last)/1e3,this.frames++,this.sec=this.now>=this.nextsec,this.sec&&(this.nextsec=this.now+1e3,this.fps=this.frames,this.frames=0);var a=this.now/1e3;this.it_10=Math.round(10*(a-Math.trunc(a))-.5),this.it_12=Math.round(12*(a-Math.trunc(a))-.5),this.it_16=Math.round(16*(a-Math.trunc(a))-.5),this.it_24=Math.round(24*(a-Math.trunc(a))-.5)}},Graphics=function(a){var b=document.getElementById("alexjo-ninja"),c=b.getContext("2d"),d=document.createElement("canvas"),e=d.getContext("2d");this.camera=a,this.zoomed=!1;var f=16,g=function(a){return Math.trunc(a/f,2)};this.blocks_rendered=0,this.entities_rendered=0,this.print=function(a){d.width=b.width=window.innerWidth,d.height=b.height=window.innerHeight,this.printTerrain(a),this.printUnits(a),this.printHUD(a),c.mozImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.msImageSmoothingEnabled=!1,c.imageSmoothingEnabled=!1,c.clearRect(0,0,b.width,b.height),c.drawImage(d,0,0,b.width*this.camera.scale,b.height*this.camera.scale),this.printDebug(a,a.units)},this.printUnits=function(a){for(var b=0;b<a.units.list.length;b++){var c=a.units.list[b].obj(a.time),d=c.sprite,f=c.pos;c.AABB;e.save(),a.units.list[b].invunerableUntil>a.time.now&&(e.globalAlpha=.7),e.drawImage(a.rsc.get(d.id),d.x,d.y,d.w,d.h,f.x-this.camera.x,f.y-this.camera.y,d.w,d.h),e.restore()}a.stats.addStat("er",a.units.list.length)},this.printTerrain=function(a){for(var b=0;b<3;b++)e.drawImage(a.rsc.get("bg.png"),0,0,240,240,240*b,-50,240,240);this.blocks_rendered=0;for(var b=g(a.camera.x)-a.camera.range.x+2;b<g(a.camera.x)+a.camera.range.x+2;b++)for(var c=g(a.camera.y)-a.camera.range.y+2;c<g(a.camera.y)+a.camera.range.y+2;c++){var d=a.level.getBlockObject(f*b,f*c),h=d.pos,i=d.sprite;Math.random()<1e-4,1,i.id>0&&(e.drawImage(a.rsc.get(a.level.sprite_sheet),i.x*f,i.y*f,i.w,i.h,h.x-a.camera.x,h.y-a.camera.y,h.w,h.h),this.blocks_rendered++)}a.stats.addStat("br",this.blocks_rendered)},this.printHUD=function(a){for(var b=a.units.p,c=0;c<b.maxHealth;c++)c<b.health?e.drawImage(a.rsc.get("hud.png"),0,0,9,9,2,30+9*c,9,9):e.drawImage(a.rsc.get("hud.png"),9,0,9,9,2,30+9*c,9,9)},this.printDebug=function(a,b){var d=a.time,e=["GameName in-dev v0.0.1 ("+(Math.round(d.now/1e3)-Math.round(d.started/1e3))+" seconds old)",1e3*d.dt+" ms / "+d.fps+" fps",b.list.length+" entities",this.blocks_rendered+"/"+2*this.camera.range.x*(2*this.camera.range.y)+" Blocks rendered","camera x: "+this.camera.x+" y: "+this.camera.y,"( pos ) x: "+Math.round(b.p.x)+" y: "+Math.round(b.p.y),"(Block) x: "+g(b.p.x)+" y: "+g(Math.round(b.p.y))];c.save(),c.globalCompositeOperation="difference",c.fillStyle="white",c.font="14px monospace";for(var f=12,h=12,i=1;i<=e.length;i++)c.fillText(e[i-1],f,h*(i+1));c.restore();var j=0,k=400,l=300,m=a.stats.blocks_rendered;c.strokeStyle="red",c.beginPath(),c.moveTo(j,k-m[i]/(2*this.camera.range.x*(2*this.camera.range.y))*l);for(var i=1;i<m.length;i++)c.lineTo(j+i,k-m[i]/(2*this.camera.range.x*(2*this.camera.range.y))*l);c.stroke(),m=a.stats.entities_rendered,c.strokeStyle="blue",c.beginPath(),c.moveTo(j,k-m[0]/6*l);for(var i=1;i<m.length;i++)c.lineTo(j+i,k-m[i]/6*l);c.stroke(),m=a.stats.frame_rate,c.strokeStyle="green",c.beginPath(),c.moveTo(j,k-m[0]/60*l);for(var i=1;i<m.length;i++)c.lineTo(j+i,k-m[i]/60*l);c.stroke()}},Level=function(a,b){this.h=29,this.w=150,this.tileSize=16,this.trunc=function(a){return Math.trunc(a/this.tileSize,2)},this.sprite_sheet="tiles.png";var c=[{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:1,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:2,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:3,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:4,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:5,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:6,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:7,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:8,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:1,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:2,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:3,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:4,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:5,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:6,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:7,y:1,w:16,h:16},AABB:{x:0,y:0,w:16,h:16}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}},{sprite:{x:0,y:0,w:16,h:16},AABB:{x:0,y:0,w:0,h:0}}],d=[[0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,1,10,9,9,9,16,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,20,19,1,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,2,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,1,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,20,0,19,2,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,2,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,1,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,2,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,2,10,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,20,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,19,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,20,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,20,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,20,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,15,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,16,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,0,0,0,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,20,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,20,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,20,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,19,3,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,19,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,19,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,12,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0,2,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,10,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,4,11,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,13,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1]];this.terrain_sprite_index=function(a){return c[a]},this.terrainSpritesNum=function(){return c.length},this.terrain=function(a,b){return a>this.w||a<0||b<0||b>this.h||void 0==a||void 0==b?0:d[a][b]},this.getHeight=function(){return this.h},this.getWidth=function(){return this.w},this.setData=function(a,b,c){return!(a>this.w||a<0||b<0||b>this.h)&&(d[a][b]=c,!0)},this.getData=function(){return d},this.getBlockObject=function(a,b){var c={x:this.trunc(a),y:this.trunc(b)},d=this.terrain(c.x,c.y),e=this.terrain_sprite_index(d);return{sprite:{x:e.sprite.x,y:e.sprite.y,w:e.sprite.w,h:e.sprite.h,id:d},pos:{x:c.x*this.tileSize,y:c.y*this.tileSize,w:e.sprite.w,h:e.sprite.h},AABB:{x:c.x*this.tileSize+e.AABB.x,y:c.y*this.tileSize+e.AABB.y,w:e.AABB.w,h:e.AABB.h,s:function(a,b){return a>this.x&&a<this.x+this.w&&(b>this.y&&b<this.y+this.h)}}}}},Stats=function(){this.blocks_rendered=new Array(300),this.entities_rendered=new Array(300),this.frame_rate=new Array(300),this.addStat=function(a,b){return"blocks_rendered"==a||"br"==a?(this.blocks_rendered.unshift(this.blocks_rendered.pop()),this.blocks_rendered[0]=b,this.blocks_rendered):"entities_rendered"==a||"er"==a?(this.entities_rendered.unshift(this.entities_rendered.pop()),this.entities_rendered[0]=b,this.entities_rendered):("frame_rate"==a||"fps"==a)&&(this.frame_rate.unshift(this.frame_rate.pop()),this.frame_rate[0]=b,this.frame_rate)}};document.addEventListener("DOMContentLoaded",function(){var a={rsc:null,universe:null};a.rsc=new ResourceLoader,a.rsc.load(["tiles.png","rpgsoldier.png","warrior.png","enemy.png","hud.png","bg.png"]),a.rsc.whenReady(function(){a.universe=new LevelCreator(16,!0,a.rsc),a.universe.init();var b=function(){a.universe.update(),aniFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,aniFrame(b,a.universe.getCanvas())};b()})});var Player=function(){this.width=15,this.height=25,this.speed=180,this.img="warrior.png",this.attackTick=-1,this.jumpPrimed=!1,this.health=10,this.maxHealth=10,this.imgSize=40,this.imgDisplacement=[12,15];var a;this.setController=function(b){a=b},this.invunerableUntil=0,this.damage=function(a,b){this.health-=a,this.invunerableUntil=b.now+500,this.health<=0&&console.log("dead")},this.move=function(b){var c=b.time,d=c.getSPF();if(a.k||0!==this.attackTick?a.k&&this.attackTick===-1&&(this.attackTick=12):this.attackTick=-1,this.attackTick>0){if(this.attackTick--,this.canMove=!1,5===this.attackTick)for(var e=b.getUnits(),f=1;f<e.length;f++){var g=e[f];1===this.direction?(g.aabb().s(this.x+this.width+25,this.y+this.height/2)||g.aabb().s(this.x+this.width+15,this.y+this.height/2)||g.aabb().s(this.x+this.width+5,this.y+this.height/2))&&g.damage(1):0===this.direction&&(g.aabb().s(this.x-25,this.y+this.height/2)||g.aabb().s(this.x-15,this.y+this.height/2)||g.aabb().s(this.x-5,this.y+this.height/2))&&g.damage(1)}}else this.canMove=!0;if(c.now>this.invunerableUntil)for(var e=b.getUnits(),f=1;f<e.length;f++){var g=e[f].aabb();g.c(this.aabb())&&this.damage(1,b.time)}this.canMove?(a.space&&this.jumpPrimed&&!this.airbourne?(this.vy=-8,this.airbourne=!0,this.jumpPrimed=!1):a.space||(this.jumpPrimed=!0),a.a||a.d||(this.vx=0),a.d?(this.vx=this.speed*d,this.direction=1):a.a&&(this.vx=-this.speed*d,this.direction=0)):this.airbourne||(this.vx=0)},this.obj=function(b){var c={x:0,y:0,w:40,h:40,id:this.img},d=this.aabb(),e=this.aabb();return d.x-=this.imgDisplacement[0],d.y-=this.imgDisplacement[1],this.airbourne?a.k?1===this.direction?(c.x=b.it_24%8*40,c.y=240):0===this.direction&&(c.x=b.it_24%8*40,c.y=280):Math.abs(this.vy)>3?(c.x=0,c.y=40*(5-this.direction)):Math.abs(this.vy)<=3||Math.abs(this.vy)>1?(c.x=40,c.y=40*(5-this.direction)):Math.abs(this.vy)<=1&&(c.x=80,c.y=40*(5-this.direction)):0===this.vx?this.attackTick>0?this.attackTick>10?1===this.direction?(c.x=120,c.y=0):0===this.direction&&(c.x=120,c.y=40):1===this.direction?(c.x=160,c.y=0,d.x+=10):0===this.direction&&(c.x=160,c.y=40,d.x-=10):this.contact.down?1===this.direction?(c.x=0,c.y=0):0===this.direction&&(c.x=0,c.y=40):this.contact.left?(c.x=200,c.y=160):this.contact.right&&(c.x=200,c.y=200):this.vx>0?(c.x=b.it_12%6*40,c.y=80):this.vx<0&&(c.x=b.it_12%6*40,c.y=120),{sprite:c,pos:d,AABB:e}}},RPGsoldier=function(a){this.width=15,this.height=25,this.img="rpgsoldier.png",this.imgSize=40,this.imgDisplacement=[12,12],this.move=function(a){this.tick++,this.tick>200&&(this.tick=0),this.vx=0,this.tick>50&&this.tick<100&&(this.vx=-this.speed,this.direction=0),this.tick>150&&this.tick<200&&(this.vx=this.speed,this.direction=1)}},Soldier=function(){this.width=15,this.height=25,this.img="enemy.png",this.imgSize=25,this.imgDisplacement=[5,0],this.move=function(a){this.tick++,this.tick>200&&(this.tick=0),this.vx=0,this.tick>50&&this.tick<100&&(this.vx=-this.speed,this.direction=0),this.tick>150&&this.tick<200&&(this.vx=this.speed,this.direction=1)}};